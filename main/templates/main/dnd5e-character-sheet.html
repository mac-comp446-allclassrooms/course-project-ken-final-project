<head>
	{% load static %}
	<link rel="stylesheet" href="{% static 'main.css' %}">
	<link rel="stylesheet" href="{% static 'dnd5e-character-sheet.css' %}">
	<script src="{% static 'dnd5e-character-sheet.js' %}" defer></script>
	{% block theme_css %}{% endblock %}
</head>

{% include 'main/index.html' %}

<body>
	
	<form id="character_sheet" method="post">
		{% csrf_token %}
		<!-- <h1>Character Sheet: {{character.name}}</h1> -->
		<div class="contentblock">
			<div class="statblock" id="profileblock">
				<div class="stat-heading">
					<h2>{{character.name}}'s Character Profile</h2>
					<button type="submit" id="save-character" name="save-character">Save Character</button>
					<!-- <button id="delete-button" type='submit' name="delete">Delete</button> -->
				</div>
				<div class="contentblock">
					<table>
						<tr class="stat">
							<th class="mediumcolumn">Name</th>
							<td><input type="text" name="character_name" value="{{character.name}}" required></td>
						</tr>
						<tr class="stat">
							<th>Species</th>
							<td><input type="text" name="species" value="{{character.species}}" required></td>
						</tr>
						<tr class="stat">
							<th>Class</th>
							<td><input type="text" name="character_class" value="{{character.character_class}}" required></td>
						</tr>
						<!-- <tr class="stat">
							<th>Subclass</th>
							<td><input type="text" name="character_subclass" value="{{character.character_subclass}}" required></td>
						</tr> -->
						<tr class="stat">
							<th>Level</th>
							<td><input type="number" id="character_level" name="character_level" value="{{character.level}}"" onchange="updateProficiencyBonus()"></td>
						</tr>
					</table>
					<table>
						<tr>
							<th class="mediumcolumn">Proficiency Bonus</th>
							<td class="largecolumn">+4</td>
						</tr>

						<tr class="stat">
							<th>Health</th>
							<td style="display: flex; justify-content: space-between;">
								<input type="number" name="hp_current" value="{{character.hp_current}}" style="width: 40%;">
								/
								<input type="number" name="hp_maximum" value="{{character.hp_maximum}}" style="width: 40%;">
							</td>
						</tr>
						<tr class="stat">
							<th>Armor Class</th>
							<td><input type="number" name="armor_class" value="{{character.armor_class}}" required></td>
						</tr>
					</table>
				</div>
			</div>
			<div class="statblock">
				<div class="stat-heading">
					<h2>Character Description</h2>
				</div>
				<div class="contentblock" style="display: flex;">
					<div class="statblock">
						<div class="stat-heading">
							<h3>Physical</h3>
						</div>
						<textarea placeholder="Physical Description"></textarea>
					</div>
					<div class="statblock">
						<div class="stat-heading">
							<h2>Personality</h2>
						</div>
						<textarea placeholder="Personality"></textarea>
					</div>
				</div>
			</div>
		</div>
			
		<div class="contentblock">
			<div class="statblock">
				<div class='ability-scores-section'>
					<div class="stat-heading">
						<h2>Abilities</h2>
					</div>
					<table class="contentblock" id="abilityblock">
						<tr>
							<th class="mediumcolumn">Ability</th>
							<th class="smallcolumn">Score</th>
							<th class="smallcolumn">Mod</th>
							<th class="mediumcolumn">Saving?</th>
						</tr>
						{% for ability in ability_scores %}
							<tr>
								<td>{{ability.name}}</td>
								<td><input type="number" class="ability-score {{ability.name}}-score" name="{{ability.name}}_ability_score" value="{{ability.score}}" min="0" max="30" onchange ="updateAbilityMod(this)"></td>
								<td>{{skill.ability_score.score}}</td>
								<td><input type="checkbox" class="saving-check-box" name="{{ability.name}}_saving_throw" onchange="updateSavingThrows()"></td>
							</tr>
						{% endfor %}
					</table>
				</div>

				<div class='saving-throws-section'>
					<h2>Saving Throws</h2>
					<table id="extra_ability_block">
					</table>
				</div>
			</div>

			<div class="statblock">
				<div class="stat-heading">
					<h2>Skills</h2>
				</div>
				<table id="skillblock">
					<tr>
						<th class="smallcolumn">Prof</th>
						<th class="mediumcolumn">Skill</th>
						<th class="mediumcolumn">Ability</th>
						<th class="smallcolumn">Mod</th>
					</tr>
					{% for skill in skills %}
					<tr>
						<td><input type="number" class='level-input'  name="{{skill.name}}_{{skill.ability_score.name}}_skill" value={{skill.proficiency}} min="0" max="2" step="0.5" onchange="updateAllAbilities()"></td>
						<!-- <td>
							<select class='level-input'  name="{{skill.name}}_{{skill.ability_score.name}}_skill" onchange="updateAllAbilities()">
								<option value=0>0</option>
								<option value=1>1</option>
								<option value=2>2</option>
								<option value=0.5>0.5</option>
							</select>
						</td> -->
						<td>{{skill.name}}</td>
						<td>({{skill.ability_score.name}})</td>
						<td class="skill-score {{skill.ability_score.name}}-skill">{{skill.ability_score.score}}</td>
					</tr>					
					{% endfor %}
				</table>
			</div>

			<div class="contentblock">
				<div class="statblock">
					<div class="stat-heading">
						<h2>Proficiencies</h2>
					</div>
					<textarea></textarea>
				</div>
				<div class="statblock">
					<div class="stat-heading">
						<h2>Traits & Features</h2>
						<button type="button" onclick="createNewTrait()">New Trait</button>
					</div>
					<table id="traitblock">
						<tr>
							<th class="extralargecolumn"></th>
							<th class="mediumcolumn"></th>
						</tr>
					</table>
				</div>
			</div>

			<div class="statblock">
				<div class="stat-heading">
					<h2>Attack</h2>
					<button type="button" onclick="createNewAttack()">New Attack</button>
				</div>
				<table id="attackblock">
					<tr>
						<th class="mediumcolumn">Name</th>
						<th class="mediumcolumn">Range</th>
						<th class="mediumcolumn">Attack Bonus</th>
						<th class="mediumcolumn">Damage Roll</th>
						<th class="mediumcolumn">Damage Type</th>
						<th class="mediumcolumn">Notes</th>
						<th class="mediumcolumn"></th>
					</tr>

					{% for attack in attacks %}
					<tr>
						<td><input type='text' name='attack_name' value='{{attack.name}}'></td>
						<td><input type='text' name='attack_range' value='{{attack.range}}'></td>
						<td><input type='text' name='attack_bonus' value='{{attack.attack_bonus}}'></td>
						<td><input type='text' name='attack_damage_roll' value='{{attack.damage_roll}}'></td>
						<td><input type='text' name='attack_damage_type' value='{{attack.damage_type}}'></td>
						<td><input type='text' name='attack_notes' value='{{attack.notes}}'></td>
						<td><button type='button' onclick = 'deleteSpell(this)'>Delete</button></td>
					</tr>
					{% endfor %}

				</table>
			</div>
		</div>
		<div class="contentblock">
			<div class="statblock">
				<div class="stat-heading">
					<h2>Inventory</h2>
					<button type="button" onclick="createNewItem()">New Item</button>
				</div>
				<table id="inventoryblock">
					<tr>
						<th class="mediumcolumn">Equipped?</th>
						<th class="largecolumn">Quantity</th>
						<th class="largecolumn">Name</th>
						<th class="largecolumn">Description</th>
						<th class="mediumcolumn">Weight</th>
						<th class="mediumcolumn"></th>
					</tr>
					{% for item in items %}
					<tr>
						<td><input type="checkbox" name='item_equipped'></td>
						<td><input type='number' name='item_quantity' value='{{item.amount}}'></td><td><input type='text' name='item_name' value="{{item.name}}"></input></td>
						<td><input type='text' name='item_description' value="{{item.description}}"></td>
						<td><input type='text' name='item_weight' value="{{item.weight}}"></td>
						<td><button type='button' onclick = 'deleteItem(this)'>Delete</button></td>
					</tr>
					{% endfor %}
				</table>
			</div>
			<div class="statblock">
				<h2>Wallet</h2>
				<table>
					<tr>
						<th class="mediumcolumn">Currency</th>
						<th class="mediumcolumn">Amount</th>
					</tr>
					<tr>
						<td>Platinum (Pp)</td>
						<td><input type="number" name="coins_platinum" value="{{character.coins_platinum}}"></td>
					</tr>
					<tr>
						<td>Gold (Gp)</td>
						<td><input type="number" name="coins_gold" value="{{character.coins_gold}}"></td>
					</tr>
					<tr>
						<td>Electrum (Ep)</td>
						<td><input type="number" name="coins_electrum" value="{{character.coins_electrum}}"></td>
					</tr>
					<tr>
						<td>Silver (Sp)</td>
						<td><input type="number" name="coins_silver" value="{{character.coins_silver}}"></td>
					</tr>
					<tr>
						<td>Copper (Cp)</td>
						<td><input type="number" name="coins_copper" value="{{character.coins_copper}}"></td>
					</tr>
				</table>
			</div>
		</div>
		<div class="statblock">
			<div class="stat-heading">
				<h2>Spells</h2>
			</div>
			<div class="contentblock">
				<div class="statblock">
					<div class="stat-heading">
						<h3>Spellcasting</h3>
						<select name="spellcasting_ability" id="spellcasting-ability">
							{% for ability in ability_scores %}
							<option value="{{ability.name}}" {% if character.spellcasting_ability == ability.name %}selected{% endif %}>{{ability.name}}</option>
							{% endfor %}
                            <option value="" {% if character.spellcasting_ability == "" %}selected{% endif %}>---</option>
						</select>
					</div>
					<table>
						<tr>
							<th class="largecolumn">Spellcasting Mod</th>
							<td class="smallcolumn">0</td>
							<!-- Ability mod -->
						</tr>
						<tr>
							<th>Spell Save DC</th>
							<td>0</td>
							<!-- 8 + proficiency bonus + ability modifier -->
						</tr>
						<tr>
							<th>Spell Attack Bonus</th>
							<td>0</td>
							<!-- ability modifier + Caster's level -->
						</tr>
					</table>
					<h3>Spellslots</h3>
					<table>
						<tr>
							<th class="smallcolumn">Level</th>
							<th class="largecolumn">Slots</th>
						</tr>
						<tr>
							<td>1</td>
							<td><input type="number" name="spell_slots_level1_current" value="{{character.spell_slots_level1_current}}" min="0" style="width: 40%;">
							/
							<input type="number" name="spell_slots_level1_maximum" value="{{character.spell_slots_level1_maximum}}" min="0" style="width: 40%;"></td>
						</tr>
						<tr>
							<td>2</td>
							<td><input type="number" name="spell_slots_level2_current" value="{{character.spell_slots_level2_current}}" min="0" style="width: 40%;">
                            /
                            <input type="number" name="spell_slots_level2_maximum" value="{{character.spell_slots_level2_maximum}}" min="0" style="width: 40%;"></td>
						</tr>
						<tr>
							<td>3</td>
							<td><input type="number" name="spell_slots_level3_current" value="{{character.spell_slots_level3_current}}" min="0" style="width: 40%;">
                            /
                            <input type="number" name="spell_slots_level3_maximum" value="{{character.spell_slots_level3_maximum}}" min="0" style="width: 40%;"></td>
						</tr>
						<tr>
							<td>4</td>
							<td><input type="number" name="spell_slots_level4_current" value="{{character.spell_slots_level4_current}}" min="0" style="width: 40%;">
                            /
                            <input type="number" name="spell_slots_level4_maximum" value="{{character.spell_slots_level4_maximum}}" min="0" style="width: 40%;"></td>
						</tr>
						<tr>
							<td>5</td>
							<td><input type="number" name="spell_slots_level5_current" value="{{character.spell_slots_level5_current}}" min="0" style="width: 40%;">
                            /
                            <input type="number" name="spell_slots_level5_maximum" value="{{character.spell_slots_level5_maximum}}" min="0" style="width: 40%;"></td>
						</tr>
						<tr>
							<td>6</td>
							<td><input type="number" name="spell_slots_level6_current" value="{{character.spell_slots_level6_current}}" min="0" style="width: 40%;">
                            /
                            <input type="number" name="spell_slots_level6_maximum" value="{{character.spell_slots_level6_maximum}}" min="0" style="width: 40%;"></td>
						</tr>
						<tr>
							<td>7</td>
							<td><input type="number" name="spell_slots_level7_current" value="{{character.spell_slots_level7_current}}" min="0" style="width: 40%;">
                            /
                            <input type="number" name="spell_slots_level7_maximum" value="{{character.spell_slots_level7_maximum}}" min="0" style="width: 40%;"></td>
						</tr>
						<tr>
							<td>8</td>
							<td><input type="number" name="spell_slots_level8_current" value="{{character.spell_slots_level8_current}}" min="0" style="width: 40%;">
                            /
                            <input type="number" name="spell_slots_level8_maximum" value="{{character.spell_slots_level8_maximum}}" min="0" style="width: 40%;"></td>
						</tr>
						<tr>
							<td>9</td>
                            <td><input type="number" name="spell_slots_level9_current" value="{{character.spell_slots_level9_current}}" min="0" style="width: 40%;">
                            /
                            <input type="number" name="spell_slots_level9_maximum" value="{{character.spell_slots_level9_maximum}}" min="0" style="width: 40%;"></td>
						</tr>
					</table>
				</div>
				
				<div class="statblock">
					<div class="stat-heading">
						<h3>Spell List</h3>
						<button type="button" onclick="createNewSpell()">New Spell</button>
					</div>
					<table id="spellblock">
						<tr>
							<th class="smallcolumn">Level</th>
							<th class="largecolumn">Name</th>
							<th class="largecolumn">Description</th>
							<th class="mediumcolumn">School</th>
							<th class="mediumcolumn"></th>
						</tr>

						{% for spell in spells %}
						<tr>
							<td><input type='number' class='level-input' name='spell_level' value='{{spell.level}}' min="0"></td>
							<td><input type='text' name='spell_name' value='{{spell.name}}'></td>
							<td><input type='text' name='spell_description' value='{{spell.description}}'></td>
							<td><input type='text' name='spell_school' value='{{spell.school}}'></td>
							<td><button type='button' onclick = 'deleteSpell(this)'>Delete</button></td>
						</tr>
						{% endfor %}
					</table>
				</div>
			</div>
		</div>

	</form>
</body>
